{% extends "base.html" %}

{% block title %}–û—Ü–µ–Ω–∏—Ç—å –∫–∞—Ñ–µ - –î–µ—Ç—Å–∫–æ–µ –∫–∞—Ñ–µ "–†–∞–¥—É–≥–∞"{% endblock %}

{% block content %}
<div class="rate-page">
    <h1>–û—Ü–µ–Ω–∏—Ç—å –∫–∞—Ñ–µ</h1>
    
    {% if not user.is_authenticated %}
    <div class="auth-required">
        <div class="auth-message">
            <h3>üîí –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
            <p>–î–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—Ñ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç</p>
            <div class="auth-actions">
                <a href="{% url 'homepage:login' %}" class="login-button">–í–æ–π—Ç–∏</a>
                <a href="{% url 'homepage:register' %}" class="register-button">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
            </div>
        </div>
    </div>
    {% else %}
    <form method="post" class="rating-form">
        {% csrf_token %}
        
        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ —Å –∑–≤–µ–∑–¥–∞–º–∏ -->
        <div class="rating-section">
            <h3>–û—Å–Ω–æ–≤–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏</h3>
            
            <div class="rating-criterion">
                <label>–ö–∞—á–µ—Å—Ç–≤–æ –µ–¥—ã</label>
                <div class="stars" data-criterion="food_quality">
                    {% for i in "54321" %}
                    <input type="radio" id="food_quality_{{ i }}" name="food_quality" value="{{ i }}" required>
                    <label for="food_quality_{{ i }}">‚òÖ</label>
                    {% endfor %}
                </div>
            </div>
            
            <div class="rating-criterion">
                <label>–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</label>
                <div class="stars" data-criterion="service_quality">
                    {% for i in "54321" %}
                    <input type="radio" id="service_quality_{{ i }}" name="service_quality" value="{{ i }}" required>
                    <label for="service_quality_{{ i }}">‚òÖ</label>
                    {% endfor %}
                </div>
            </div>
            
            <div class="rating-criterion">
                <label>–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞</label>
                <div class="stars" data-criterion="atmosphere">
                    {% for i in "54321" %}
                    <input type="radio" id="atmosphere_{{ i }}" name="atmosphere" value="{{ i }}" required>
                    <label for="atmosphere_{{ i }}">‚òÖ</label>
                    {% endfor %}
                </div>
            </div>
            
            <div class="rating-criterion">
                <label>–ß–∏—Å—Ç–æ—Ç–∞</label>
                <div class="stars" data-criterion="cleanliness">
                    {% for i in "54321" %}
                    <input type="radio" id="cleanliness_{{ i }}" name="cleanliness" value="{{ i }}" required>
                    <label for="cleanliness_{{ i }}">‚òÖ</label>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ —Å –≤—ã–±–æ—Ä–æ–º -->
        <div class="rating-section">
            <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏</h3>
            
            <div class="choice-criterion">
                <label for="food_taste">–í–∫—É—Å –µ–¥—ã</label>
                <select id="food_taste" name="food_taste" class="form-select">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</option>
                    <option value="excellent">–û—á–µ–Ω—å –≤–∫—É—Å–Ω–∞—è</option>
                    <option value="good">–í–∫—É—Å–Ω–∞—è</option>
                    <option value="average">–ù–æ—Ä–º–∞–ª—å–Ω–∞—è</option>
                    <option value="poor">–ù–µ –æ—á–µ–Ω—å</option>
                    <option value="bad">–ù–µ –≤–∫—É—Å–Ω–∞—è</option>
                </select>
            </div>
            
            <div class="choice-criterion">
                <label for="portion_size">–†–∞–∑–º–µ—Ä –ø–æ—Ä—Ü–∏–π</label>
                <select id="portion_size" name="portion_size" class="form-select">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</option>
                    <option value="large">–û—á–µ–Ω—å –±–æ–ª—å—à–∏–µ</option>
                    <option value="normal">–ù–æ—Ä–º–∞–ª—å–Ω—ã–µ</option>
                    <option value="small">–ú–∞–ª–µ–Ω—å–∫–∏–µ</option>
                </select>
            </div>
            
            <div class="choice-criterion">
                <label for="speed_service">–°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è</label>
                <select id="speed_service" name="speed_service" class="form-select">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</option>
                    <option value="fast">–û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ</option>
                    <option value="normal">–ù–æ—Ä–º–∞–ª—å–Ω–æ</option>
                    <option value="slow">–ú–µ–¥–ª–µ–Ω–Ω–æ</option>
                    <option value="very_slow">–û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ</option>
                </select>
            </div>
            
            <div class="choice-criterion">
                <label for="staff_friendliness">–í–µ–∂–ª–∏–≤–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∞</label>
                <select id="staff_friendliness" name="staff_friendliness" class="form-select">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</option>
                    <option value="excellent">–û—á–µ–Ω—å –≤–µ–∂–ª–∏–≤—ã–µ</option>
                    <option value="good">–í–µ–∂–ª–∏–≤—ã–µ</option>
                    <option value="average">–ù–æ—Ä–º–∞–ª—å–Ω—ã–µ</option>
                    <option value="poor">–ù–µ –æ—á–µ–Ω—å –≤–µ–∂–ª–∏–≤—ã–µ</option>
                </select>
            </div>
            
            <div class="choice-criterion">
                <label for="price_quality">–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏ –∫–∞—á–µ—Å—Ç–≤–∞</label>
                <select id="price_quality" name="price_quality" class="form-select">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</option>
                    <option value="excellent">–û—Ç–ª–∏—á–Ω–æ–µ</option>
                    <option value="good">–•–æ—Ä–æ—à–µ–µ</option>
                    <option value="fair">–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ</option>
                    <option value="poor">–ü–ª–æ—Ö–æ–µ</option>
                </select>
            </div>
            
            <div class="choice-criterion">
                <label for="child_friendly">–£–¥–æ–±—Å—Ç–≤–æ –¥–ª—è –¥–µ—Ç–µ–π</label>
                <select id="child_friendly" name="child_friendly" class="form-select">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</option>
                    <option value="excellent">–û—Ç–ª–∏—á–Ω–æ</option>
                    <option value="good">–•–æ—Ä–æ—à–æ</option>
                    <option value="average">–ù–æ—Ä–º–∞–ª—å–Ω–æ</option>
                    <option value="poor">–ü–ª–æ—Ö–æ</option>
                </select>
            </div>
        </div>
        
        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
        <div class="rating-section">
            <h3>–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h3>
            <div class="comment-criterion">
                <label for="comment">–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –≤–∞—à–∏–º–∏ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º–∏</label>
                <textarea id="comment" name="comment" class="form-textarea" 
                          placeholder="–ß—Ç–æ –≤–∞–º –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å –∏–ª–∏ –Ω–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å?..." 
                          maxlength="500"></textarea>
                <div class="char-counter"><span id="char-count">0</span>/500 —Å–∏–º–≤–æ–ª–æ–≤</div>
            </div>
        </div>
        
        <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è -->
        <div class="rating-section">
            <div class="recommendation-criterion">
                <label>–ü–æ—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç–µ –ª–∏ –≤—ã –Ω–∞—à–µ –∫–∞—Ñ–µ –¥—Ä—É–∑—å—è–º?</label>
                <div class="recommendation-options">
                    <label class="radio-option">
                        <input type="radio" name="recommend" value="yes" required>
                        <span class="radio-checkmark"></span>
                        –î–∞, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="recommend" value="maybe">
                        <span class="radio-checkmark"></span>
                        –í–æ–∑–º–æ–∂–Ω–æ
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="recommend" value="no">
                        <span class="radio-checkmark"></span>
                        –ù–µ—Ç
                    </label>
                </div>
            </div>
        </div>
        
        <button type="submit" class="submit-rating-button">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</button>
    </form>
    {% endif %}
</div>

<style>
.rate-page {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
.auth-required {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 400px;
}

.auth-message {
    background: white;
    padding: 40px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    text-align: center;
    max-width: 400px;
}

.auth-message h3 {
    color: #333;
    margin-bottom: 15px;
    font-size: 24px;
}

.auth-message p {
    color: #6c757d;
    margin-bottom: 25px;
    font-size: 16px;
}

.auth-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
}

.login-button, .register-button {
    padding: 12px 25px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
    border: none;
    font-size: 16px;
    cursor: pointer;
}

.login-button {
    background: #4ecdc4;
    color: white;
}

.login-button:hover {
    background: #3db8af;
    transform: translateY(-2px);
}

.register-button {
    background: #ffd166;
    color: #333;
}

.register-button:hover {
    background: #ffc847;
    transform: translateY(-2px);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã –æ—Ü–µ–Ω–∫–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö) */
.rating-form {
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.rating-section {
    margin-bottom: 30px;
    padding-bottom: 25px;
    border-bottom: 2px solid #f8f9fa;
}

.rating-section:last-of-type {
    border-bottom: none;
    margin-bottom: 20px;
}

.rating-section h3 {
    color: #333;
    margin-bottom: 20px;
    font-size: 20px;
    border-left: 4px solid #4ecdc4;
    padding-left: 15px;
}

/* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
.rating-criterion {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 10px;
    transition: all 0.3s ease;
}

.rating-criterion:hover {
    background: #e9ecef;
    transform: translateX(5px);
}

.rating-criterion label {
    font-weight: 600;
    color: #495057;
    min-width: 120px;
}

.stars {
    display: flex;
    flex-direction: row-reverse;
    justify-content: flex-end;
}

.stars input {
    display: none;
}

.stars label {
    font-size: 30px;
    color: #ddd;
    cursor: pointer;
    transition: color 0.2s ease;
    margin: 0 2px;
    min-width: auto;
}

.stars label:hover,
.stars label:hover ~ label,
.stars input:checked ~ label {
    color: #ffd166;
}

.stars input:checked + label {
    color: #ffb700;
}

.choice-criterion {
    margin-bottom: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 10px;
    transition: all 0.3s ease;
}

.choice-criterion:hover {
    background: #e9ecef;
    transform: translateX(5px);
}

.choice-criterion label {
    display: block;
    font-weight: 600;
    color: #495057;
    margin-bottom: 8px;
}

.form-select {
    width: 100%;
    max-width: 300px;
    padding: 10px 15px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    font-size: 16px;
    background: white;
    transition: all 0.3s ease;
}

.form-select:focus {
    outline: none;
    border-color: #4ecdc4;
    box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
}

.comment-criterion {
    padding: 15px;
    background: #f8f9fa;
    border-radius: 10px;
}

.comment-criterion label {
    display: block;
    font-weight: 600;
    color: #495057;
    margin-bottom: 8px;
}

.form-textarea {
    width: 100%;
    min-height: 120px;
    padding: 15px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    font-size: 16px;
    font-family: inherit;
    resize: vertical;
    transition: all 0.3s ease;
}

.form-textarea:focus {
    outline: none;
    border-color: #4ecdc4;
    box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
}

.char-counter {
    text-align: right;
    font-size: 14px;
    color: #6c757d;
    margin-top: 5px;
}

.recommendation-criterion {
    padding: 15px;
    background: #f8f9fa;
    border-radius: 10px;
}

.recommendation-criterion label {
    display: block;
    font-weight: 600;
    color: #495057;
    margin-bottom: 15px;
}

.recommendation-options {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
}

.radio-option {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-weight: normal;
    padding: 10px 15px;
    background: white;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.radio-option:hover {
    border-color: #4ecdc4;
    transform: translateY(-2px);
}

.radio-option input {
    margin-right: 10px;
}

.radio-checkmark {
    width: 18px;
    height: 18px;
    border: 2px solid #ddd;
    border-radius: 50%;
    margin-right: 10px;
    position: relative;
    transition: all 0.3s ease;
}

.radio-option input:checked + .radio-checkmark {
    border-color: #4ecdc4;
    background: #4ecdc4;
}

.radio-option input:checked + .radio-checkmark::after {
    content: '';
    position: absolute;
    top: 4px;
    left: 4px;
    width: 6px;
    height: 6px;
    background: white;
    border-radius: 50%;
}

.submit-rating-button {
    background: #4ecdc4;
    color: white;
    border: none;
    padding: 15px 40px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    font-size: 18px;
    transition: all 0.3s ease;
    width: 100%;
    margin-top: 10px;
}

.submit-rating-button:hover {
    background: #3db8af;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(78, 205, 196, 0.3);
}

@media (max-width: 768px) {
    .rate-page {
        padding: 15px;
    }
    
    .rating-form {
        padding: 20px;
    }
    
    .rating-criterion {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .recommendation-options {
        flex-direction: column;
        gap: 10px;
    }
    
    .form-select {
        max-width: 100%;
    }
    
    .auth-actions {
        flex-direction: column;
    }
    
    .login-button, .register-button {
        text-align: center;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
    const commentTextarea = document.getElementById('comment');
    const charCount = document.getElementById('char-count');
    
    if (commentTextarea && charCount) {
        commentTextarea.addEventListener('input', function() {
            charCount.textContent = this.value.length;
        });
    }

    const ratingForm = document.getElementById('ratingForm');
    if (ratingForm) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
        ratingForm.addEventListener('submit', function(e) {
            const foodQuality = document.querySelector('input[name="food_quality"]:checked');
            const serviceQuality = document.querySelector('input[name="service_quality"]:checked');
            const atmosphere = document.querySelector('input[name="atmosphere"]:checked');
            const cleanliness = document.querySelector('input[name="cleanliness"]:checked');
            const recommend = document.querySelector('input[name="recommend"]:checked');
            
            if (!foodQuality || !serviceQuality || !atmosphere || !cleanliness || !recommend) {
                e.preventDefault();
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–∑–≤–µ–∑–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é)');
                return false;
            }
        });
    }
});
</script>
{% endblock %}